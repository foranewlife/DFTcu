#include <cmath>
#include <algorithm>
#include "model/wavefunction_builder.cuh"
#include "math/ylm.cuh"
#include "math/bessel.cuh"
#include "utilities/constants.cuh"
#include "utilities/error.cuh"
#include "utilities/math_utils.cuh"

namespace dftcu {

namespace {
__global__ void test_write_kernel(int nnr, gpufftComplex* data) {
    int i = blockIdx.x * blockDim.x + threadIdx.x;
    if (i < nnr) {
        data[i].x = 1.0;
        data[i].y = 0.0;
    }
}
}

// ...

void WavefunctionBuilder::build_atomic_wavefunctions(Wavefunction& psi, bool randomize_phase) {
    int n_bands = psi.num_bands();
    int nnr = grid_.nnr();

    grid_.synchronize();
    cudaMemset(psi.data(), 0, n_bands * nnr * sizeof(gpufftComplex));

    for (int nb = 0; nb < n_bands; ++nb) {
        test_write_kernel<<<(nnr + 255) / 256, 256, 0, grid_.stream()>>>(nnr, psi.band_data(nb));
    }
    grid_.synchronize();
}

} // namespace dftcu
